'use strict';var ReferenceInput=function(b){var f=function(a,d){this.id=a;this.url=d;b(document).ready(b.proxy(this.prepare,this));document.changeInput=function(e){b(e).change()}};var c=f.prototype;c.prepare=function(){this.$result=b(document.createElement("div")).addClass("ac-reference-list").addClass("SEARCH_"+this.id);this.$input=b(document.getElementById(this.id));this.$form=this.$input.closest(".ac-reference").append(this.$result);this.$search=this.$form.find(".ac-reference-search");this.$button=
this.$form.find(".ac-reference-get");this.$button.click(b.proxy(this.modal,this));this.$input.change(b.proxy(this.change,this)).change();this.$search.keyup(b.proxy(this.search,this));b("body").click(b.proxy(this.bodyAction,this))};c.change=function(){0>=this.$input.val().length?(this.$form.removeClass("more"),"object"===typeof this.$more&&this.$more.remove()):("object"===typeof this.$more&&this.$more.remove(),this.$form.removeClass("more").addClass("loading"),this.$input.prop("disabled",!0),this.$button.prop("disabled",
!0),this.$search.val("").prop("disabled",!0),b.post({url:this.url,data:{"reference-page":"Y","reference-name":this.$input.val()},dataType:"json"}).done(b.proxy(this.changeHandler,this)))};c.changeHandler=function(a){this.$form.removeClass("loading");this.$input.val(a.value).removeAttr("disabled");this.$button.removeAttr("disabled");this.$search.val(a.name).removeAttr("disabled");"string"===typeof a.more&&(this.lastMoreUrl=a.more,"object"===typeof this.$more&&this.$more.remove(),this.$more=b(document.createElement("button")).attr("type",
"button").addClass("ac-reference-more"),a.icon&&this.$more.addClass(a.icon),this.$form.addClass("more"),this.$form.append(this.$more),this.$more.click(b.proxy(this.moreClick,this)))};c.search=function(){1>=this.$search.val().length?this.$result.slideUp():(this.$form.addClass("loading"),this.$button.prop("disabled",!0),b.post({url:this.url,data:{"reference-page":"Y","reference-search":this.$search.val()},dataType:"json"}).done(b.proxy(this.searchHandler,this)))};c.searchHandler=function(a){var d;this.$form.removeClass("loading");
this.$button.removeAttr("disabled");a=a.result;if("object"!==typeof a)this.$result.slideUp();else{this.$result.html("");var e=!1;for(d in a)a.hasOwnProperty(d)&&(e=!0,this.$result.append(b(document.createElement("span")).attr("data-value",d).html(a[d]).click(b.proxy(this.select,this))));e?this.$result.slideDown():this.$result.slideUp()}};c.bodyAction=function(a){0>=b(a.target).closest(".SEARCH_"+this.id).length&&this.$result.slideUp()};c.select=function(a){a=b(a.target).closest("span").data("value");
this.$result.slideUp();this.$search.val("");this.$input.val(a).change()};c.moreClick=function(){window.open(this.lastMoreUrl,"MORE_INFO_"+this.id,"scrollbars=yes,resizable=yes,width=800,height=500,top="+Math.floor((screen.height-500)/2-14)+",left="+Math.floor((screen.width-800)/2-5))};c.modal=function(){window.open(this.url+"?lang=ru&reference-page=Y&reference-input="+this.id,"REFERENCE_"+this.id,"scrollbars=yes,resizable=yes,width=800,height=500,top="+Math.floor((screen.height-500)/2-14)+",left="+
Math.floor((screen.width-800)/2-5))};return f}(jQuery);
