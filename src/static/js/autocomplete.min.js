'use strict';var AutocompleteInput=function(b){var f=function(a,c){this.id=a;this.url=c;this.$wrap=b("#"+this.id);this.isSearchMode=this.$wrap.hasClass("search");this.$result=this.$wrap.find("[data-result]");this.$input=this.$wrap.find("input");this.isSearchMode||(this.$input.after('<button type="button"></button>'),this.$button=this.$wrap.find("button"),this.$button.click(b.proxy(function(b){this.$result.is(":visible")?this.$result.slideUp(100):(this.$wrap.find("[data-result] > span").show(),this.$result.slideDown(100))},
this)),this.$wrap.find("[data-result] > span").click(b.proxy(this.select,this)));this.$input.on("keyup",b.proxy(this.changeInput,this));this.$input.on("change",b.proxy(this.changeInput,this));b(document).click(b.proxy(function(a){b(a.target).closest("[data-result]").is(this.$result)||this.$button&&b(a.target).closest("button").is(this.$button)||this.$result.slideUp(100)},this))};var d=f.prototype;d.select=function(a){this.$input.val(b(a.target).closest("[data-value]").attr("data-value"));this.$result.slideUp(50)};
d.changeInput=function(a){if(this.isSearchMode)this.search();else{a=b(a.target).val().trim();var c=new RegExp(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");0<this.$wrap.find("[data-result] > span").hide().filter(function(){var a=b(this).data("name"),e=b(this).html();a=a||e;e=!1;"string"!==typeof a?e=!1:c.test(a)&&(e=!0);return e}).show().length&&0<a.length?this.$result.slideDown(50):this.$result.slideUp(50)}};d.search=function(){1>=this.$input.val().length?this.$result.slideUp(100):this._lastQuery!==
this.$input.val()&&(this._lastQuery=this.$input.val(),this.$wrap.addClass("loading"),b.post({url:this.url,data:{"reference-page":"Y","reference-autocomplete":"Y","reference-search":this.$input.val()},dataType:"json"}).done(b.proxy(this.searchHandler,this)))};d.searchHandler=function(a){var c;this.$wrap.removeClass("loading");a=a.result;if("object"!==typeof a)this.$result.slideUp(100);else{this.$result.html("");var d=!1;for(c in a)a.hasOwnProperty(c)&&(d=!0,this.$result.append(b(document.createElement("span")).attr("data-value",
c).html(a[c]).click(b.proxy(this.select,this))));d?this.$result.slideDown(100):this.$result.slideUp(100)}};return f}(jQuery);
